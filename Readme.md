# Info API Kubernetes Release Manager

–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–∏–∑–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–µ —Å –ø–æ–º–æ—â—å—é Bash-—Å–∫—Ä–∏–ø—Ç–æ–≤.

---

## üì¶ –û –ø—Ä–æ–µ–∫—Ç–µ

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç:

- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `info-api` –Ω–∞ FastAPI.
- –°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–µ–ª–∏–∑–æ–≤ –≤ Kubernetes.
- –ü–æ–¥–¥–µ—Ä–∂–∫—É —Å–±–æ—Ä–∫–∏ –Ω–æ–≤—ã—Ö —Ä–µ–ª–∏–∑–æ–≤, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞, –æ—Ç–∫–∞—Ç–∞ –∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏.

**–ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è CI/CD –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.**

---

## üõ† –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- [Docker](https://www.docker.com/)
- [Kind](https://kind.sigs.k8s.io/) (Kubernetes in Docker)
- [kubectl](https://kubernetes.io/docs/tasks/tools/)
- Bash (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Windows ‚Äî WSL –∏–ª–∏ Git Bash)

---

## üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```plaintext
info-api/
‚îú‚îÄ‚îÄ app.py                   # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ FastAPI
‚îú‚îÄ‚îÄ Dockerfile               # –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
‚îú‚îÄ‚îÄ active-release.txt       # –ò–º—è —Ç–µ–∫—É—â–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–ª–∏–∑–∞
‚îú‚îÄ‚îÄ deploys/                 # –ò—Å—Ç–æ—Ä–∏—è YAML —Ñ–∞–π–ª–æ–≤ —Ä–µ–ª–∏–∑–æ–≤
‚îú‚îÄ‚îÄ release.sh               # –°–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∫–∏ –∏ –≤—ã–∫–ª–∞–¥–∫–∏ –Ω–æ–≤–æ–≥–æ —Ä–µ–ª–∏–∑–∞
‚îú‚îÄ‚îÄ switch.sh                # –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –Ω–æ–≤—ã–π —Ä–µ–ª–∏–∑
‚îú‚îÄ‚îÄ rollback.sh              # –û—Ç–∫–∞—Ç —Ä–µ–ª–∏–∑–∞ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π
‚îî‚îÄ‚îÄ finalize.sh              # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–ª–∏–∑–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ
```

---

## üöÄ –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞

–°–æ–∑–¥–∞–π Kubernetes –∫–ª–∞—Å—Ç–µ—Ä —á–µ—Ä–µ–∑ Kind —Å –Ω—É–∂–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π:

```yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  - role: control-plane
    extraPortMappings:
      - containerPort: 30080
        hostPort: 30080
        protocol: TCP
  - role: worker
  - role: worker
```

–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞:

```bash
kind create cluster --name multi --config kind-config.yaml
```

–°–æ–∑–¥–∞–π —Å–µ—Ä–≤–∏—Å `info-api-service`:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: info-api-service
spec:
  type: NodePort
  selector:
    app: info-api
    release: v1
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
      nodePort: 30080
```

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:

```bash
kubectl apply -f info-api-service.yaml
```

---

### 2. –í—ã–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ —Ä–µ–ª–∏–∑–∞

```bash
./release.sh v2
```

- –°–æ–±–∏—Ä–∞–µ—Ç—Å—è Docker-–æ–±—Ä–∞–∑ `info-api:v2`.
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ kind-–∫–ª–∞—Å—Ç–µ—Ä.
- –°–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π Deployment `info-api-v2`.
- YAML —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–∞–ø–∫—É `deploys/`.

---

### 3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –Ω–æ–≤—ã–π —Ä–µ–ª–∏–∑

```bash
./switch.sh v2
```

- –°–µ—Ä–≤–∏—Å `info-api-service` –ø–µ—Ä–µ–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `release: v2`.
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª `active-release.txt`.

---

### 4. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–ª–∏–∑–∞

```bash
./finalize.sh
```

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–ª–∏–∑.
- –£–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç—ã –∏ –ø–æ–¥—ã —Å—Ç–∞—Ä—à–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–ª–∏–∑–∞.

---

### 5. –û—Ç–∫–∞—Ç —Ä–µ–ª–∏–∑–∞ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```bash
./rollback.sh
```

- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–µ–ª–∏–∑.
- –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ –Ω–æ–≤–æ–≥–æ —Ä–µ–ª–∏–∑–∞.

---

## üìà –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—á–∏—Ö —Ü–µ–ø–æ—á–µ–∫

### –ù–æ–≤—ã–π —Ä–µ–ª–∏–∑

```bash
./release.sh v3
./switch.sh v3
./finalize.sh
```

### –û—Ç–∫–∞—Ç —Ä–µ–ª–∏–∑–∞

```bash
./rollback.sh
```

---

## üìã –í–∞–∂–Ω–æ

- –°–∫—Ä–∏–ø—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É –≤–µ—Ä—Å–∏–π –≤–∏–¥–∞ `v1`, `v2`, `v3` –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.
- –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–∞—Ñ–∏–∫ —É–∂–µ –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ –Ω–æ–≤—ã–π —Ä–µ–ª–∏–∑.
- –í—Å–µ YAML'—ã –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `deploys/` –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏.

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

–°–≤–æ–±–æ–¥–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ª—é–±—ã—Ö —Ü–µ–ª–µ–π.

---

## ‚ú®

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –≤ —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª—è—Ö –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è Kubernetes, –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ CI/CD –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª–∏–∑–∞–º–∏.
